project(nemoux)

cmake_minimum_required(VERSION 2.8 FATAL_ERROR)

cmake_policy(VERSION 2.8)

set(CMAKE_INCLUDE_CURRENT_DIR ON)
set(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake" ${CMAKE_MODULE_PATH})
set(BUILD_SHARED_LIBS ON)

set(CMAKE_SKIP_BUILD_RPATH FALSE)
set(CMAKE_BUILD_WITH_INSTALL_RPATH TRUE)
set(CMAKE_INSTALL_RPATH "${CMAKE_INSTALL_PREFIX}/lib")

set(CMAKE_INSTALL_PREFIX "/usr")

option(WITH_LOGIND "Build with LOGIND" OFF)
option(WITH_UNWIND "Build with UNWIND" OFF)
option(WITH_XWAYLAND "Build with XWAYLAND" ON)
option(WITH_GLIB "Build with GLIB" ON)
option(WITH_PULSEAUDIO "Build with PULSEAUDIO" ON)
option(WITH_MUPDF "Build with MUPDF" ON)
option(WITH_CEF "Build with CEF" ON)
option(WITH_HANGUL "Build with HANGUL" ON)

option(WITH_WAYLANDSHELL "Build with WAYLANDSHELL" ON)
option(WITH_XDGSHELL "Build with XDGSHELL" ON)
option(WITH_FULLSCREEN "Build with FULLSCREEN" ON)

option(WITH_MESA_DMABUF "Build with MESA's DMABUF" OFF)
option(WITH_MESA_RENDERNODE "Build with MESA's RENDERNODE" OFF)

option(WITH_TOUCH_TO_POINTER "Build with Touch to Pointer" OFF)

option(WITH_SHOWEXPR "Build with NEMOSHOW's EXPR" OFF)

option(WITH_OPTIMIZE "Build with OPTIMIZE" ON)
option(WITH_DEBUG "Build with DEBUG" OFF)
option(WITH_PROFILE "Build with PROFILE" OFF)
option(WITH_NEMO_DEBUG "Build with NEMODEBUG" ON)
option(WITH_NEMO_LOG "Build with NEMOLOG" ON)
option(WITH_XWAYLAND_DEBUG "Build with XWAYLANDDEBUG" OFF)

include(wayland)

FIND_PACKAGE(PkgConfig REQUIRED)

PKG_CHECK_MODULES(PIXMAN REQUIRED pixman-1)
INCLUDE_DIRECTORIES(${PIXMAN_INCLUDE_DIRS})
LINK_DIRECTORIES(${PIXMAN_LIBRARY_DIRS})

PKG_CHECK_MODULES(CAIRO REQUIRED cairo)
INCLUDE_DIRECTORIES(${CAIRO_INCLUDE_DIRS})
LINK_DIRECTORIES(${CAIRO_LIBRARY_DIRS})

PKG_CHECK_MODULES(FREETYPE REQUIRED freetype2)
INCLUDE_DIRECTORIES(${FREETYPE_INCLUDE_DIRS})
LINK_DIRECTORIES(${FREETYPE_LIBRARY_DIRS})

PKG_CHECK_MODULES(HARFBUZZ REQUIRED harfbuzz)
INCLUDE_DIRECTORIES(${HARFBUZZ_INCLUDE_DIRS})
LINK_DIRECTORIES(${HARFBUZZ_LIBRARY_DIRS})

PKG_CHECK_MODULES(FONTCONFIG REQUIRED fontconfig)
INCLUDE_DIRECTORIES(${FONTCONFIG_INCLUDE_DIRS})
LINK_DIRECTORIES(${FONTCONFIG_LIBRARY_DIRS})

PKG_CHECK_MODULES(LIBPNG REQUIRED libpng)
INCLUDE_DIRECTORIES(${LIBPNG_INCLUDE_DIRS})
LINK_DIRECTORIES(${LIBPNG_LIBRARY_DIRS})

PKG_CHECK_MODULES(LIBEXPAT REQUIRED expat)
INCLUDE_DIRECTORIES(${LIBEXPAT_INCLUDE_DIRS})
LINK_DIRECTORIES(${LIBEXPAT_LIBRARY_DIRS})

PKG_CHECK_MODULES(LIBCURL REQUIRED libcurl)
INCLUDE_DIRECTORIES(${LIBCURL_INCLUDE_DIRS})
LINK_DIRECTORIES(${LIBCURL_LIBRARY_DIRS})

PKG_CHECK_MODULES(XKBCOMMON REQUIRED xkbcommon)
INCLUDE_DIRECTORIES(${XKBCOMMON_INCLUDE_DIRS})
LINK_DIRECTORIES(${XKBCOMMON_LIBRARY_DIRS})

PKG_CHECK_MODULES(GL REQUIRED gl)
INCLUDE_DIRECTORIES(${GL_INCLUDE_DIRS})
LINK_DIRECTORIES(${GL_LIBRARY_DIRS})

PKG_CHECK_MODULES(EGL REQUIRED egl)
INCLUDE_DIRECTORIES(${EGL_INCLUDE_DIRS})
LINK_DIRECTORIES(${EGL_LIBRARY_DIRS})

include_directories(
	${CMAKE_CURRENT_BINARY_DIR}
	${CMAKE_SOURCE_DIR}/misc
	${CMAKE_SOURCE_DIR}/asst
	)

if(WITH_OPTIMIZE)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -O2 -Wno-unused-result")
endif(WITH_OPTIMIZE)

if(WITH_DEBUG)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -g")
endif(WITH_DEBUG)

if(WITH_PROFILE)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -pg")
	set(CMAKE_LINK_FLAGS "${CMAKE_LINK_FLAGS} -pg")
endif(WITH_PROFILE)

if(WITH_NEMO_DEBUG)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DNEMO_DEBUG_ON")
endif(WITH_NEMO_DEBUG)

if(WITH_NEMO_LOG)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DNEMO_LOG_ON")
endif(WITH_NEMO_LOG)

if(WITH_XWAYLAND_DEBUG)
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DXWAYLAND_DEBUG_ON")
endif(WITH_XWAYLAND_DEBUG)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS}")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CMAKE_C_FLAGS}")
set(CMAKE_LINK_FLAGS "${CMAKE_LINK_FLAGS}")

set(NEMOUX_COMMON_LIBRARIES
	m
	jpeg
	${PIXMAN_LIBRARIES}
	${CAIRO_LIBRARIES}
	${FREETYPE_LIBRARIES}
	${HARFBUZZ_LIBRARIES}
	${FONTCONFIG_LIBRARIES}
	${LIBPNG_LIBRARIES}
	${LIBEXPAT_LIBRARIES}
	${LIBCURL_LIBRARIES}
	${XKBCOMMON_LIBRARIES}
	${GL_LIBRARIES}
	${EGL_LIBRARIES}
	)

if(WITH_MESA_DMABUF)
	add_definitions(-DNEMOUX_WITH_MESA_DMABUF=1)
endif(WITH_MESA_DMABUF)

if(WITH_MESA_RENDERNODE)
	add_definitions(-DNEMOUX_WITH_MESA_RENDERNODE=1)
endif(WITH_MESA_RENDERNODE)

if(WITH_UNWIND)
	add_definitions(-DNEMOUX_WITH_UNWIND=1)

	set(NEMOUX_COMMON_LIBRARIES
		${NEMOUX_COMMON_LIBRARIES}
		unwind
		)
endif(WITH_UNWIND)

if(WITH_GLIB)
	add_definitions(-DNEMOUX_WITH_GLIB=1)
endif(WITH_GLIB)

if(WITH_PULSEAUDIO)
	add_definitions(-DNEMOUX_WITH_PULSEAUDIO=1)
endif(WITH_PULSEAUDIO)

if(WITH_XWAYLAND)
	add_definitions(-DNEMOUX_WITH_XWAYLAND=1)

	add_subdirectory(xwayland)
endif(WITH_XWAYLAND)

add_subdirectory(asst)

add_subdirectory(tool)
add_subdirectory(tale)
add_subdirectory(show)
add_subdirectory(mote)
add_subdirectory(play)

if(WITH_CEF)
	add_subdirectory(navi)
endif(WITH_CEF)

add_subdirectory(compz)
add_subdirectory(shell)
add_subdirectory(sound)
add_subdirectory(envs)
add_subdirectory(apps)
add_subdirectory(tests)
